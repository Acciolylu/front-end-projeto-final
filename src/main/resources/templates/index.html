<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livros Cadastrados</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <a href="/formLivro" class="btn-cadastrar">Cadastrar Novo Livro</a>
    <h2>Livros Cadastrados</h2>
    <table id="tabelaLivros">
        <thead>
            <tr>
                <th>Título</th>
                <th>Autor</th>
                <th>Ano</th>
                <th>Nº Páginas</th>
                <th>Preço</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="livrosCorpo"></tbody>
    </table>

    <script>
        // URL da API (ajuste para a porta do seu backend)
        const API_URL = "http://localhost:8081/livros";

        // Carregar livros ao abrir a página
        document.addEventListener("DOMContentLoaded", () => {
            listarLivros();
        });

        // Função para listar livros
        async function listarLivros() {
            try {
                const response = await fetch(`${API_URL}/listall`);
                const livros = await response.json();
                const livrosCorpo = document.getElementById("livrosCorpo");
                livrosCorpo.innerHTML = "";

                // Preencher a tabela com os livros
                livros.forEach(livro => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${livro.titulo}</td>
                        <td>${livro.autor}</td>
                        <td>${livro.ano_publicacao}</td>
                        <td>${livro.num_paginas}</td>
                        <td>R$ ${livro.preco.toFixed(2)}</td>
                        <td>
                            <button class="btn-visualizar" onclick="verDetalhes(${livro.id_livro})">Detalhes</button>
                            <button class="btn-editar" onclick="editarLivro(${livro.id_livro})">Editar</button>
                            <button class="btn-deletar" onclick="deletarLivro(${livro.id_livro})">Deletar</button>
                        </td>
                    `;
                    livrosCorpo.appendChild(row);
                });
            } catch (error) {
                console.error("Erro ao carregar livros:", error);
                alert("Erro ao carregar a lista de livros.");
            }
        }

        // Redirecionar para a página de edição
        function editarLivro(id) {
            window.location.href = `/formLivro?id=${id}&modo=editar`;
        }

        // Redirecionar para a página de detalhes
        function verDetalhes(id) {
            window.location.href = `/formLivro?id=${id}&modo=visualizar`;
        }

        // Deletar livro
        async function deletarLivro(id) {
            if (confirm("Tem certeza que deseja excluir este livro?")) {
                try {
                    const response = await fetch(`${API_URL}/${id}`, {
                        method: "DELETE",
                    });
                    if (response.ok) {
                        alert("Livro deletado com sucesso!");
                        listarLivros(); // Atualizar a lista
                    } else {
                        alert("Erro ao deletar o livro.");
                    }
                } catch (error) {
                    console.error("Erro ao deletar livro:", error);
                }
            }
        }
    </script>
</body>
</html>
